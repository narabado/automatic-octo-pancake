<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">ãªã‚‰ãƒãƒ‰å¹´æœ«å¹´å§‹ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³äº¤æµä¼š ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼</title>
  <style>
    /* =================================
       ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ»ãƒ™ãƒ¼ã‚¹
       ================================= */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', 'Yu Gothic', 'Hiragino Sans', sans-serif;
      background: linear-gradient(135deg, #1a0033 0%, #4a148c 30%, #7b1fa2 60%, #ff6f00 100%);
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow-x: hidden;
    }

    /* é›ªã®çµæ™¶ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes snowfall {
      0% {
        transform: translateY(-10vh) rotate(0deg);
        opacity: 0.8;
      }
      100% {
        transform: translateY(110vh) rotate(360deg);
        opacity: 0;
      }
    }

    .snowflake {
      position: fixed;
      top: -10vh;
      color: rgba(255, 255, 255, 0.6);
      font-size: 1.5em;
      user-select: none;
      pointer-events: none;
      z-index: 1;
      animation: snowfall linear infinite;
    }

    .snowflake:nth-child(1) { left: 10%; animation-duration: 8s; animation-delay: 0s; }
    .snowflake:nth-child(2) { left: 20%; animation-duration: 10s; animation-delay: 1s; }
    .snowflake:nth-child(3) { left: 30%; animation-duration: 12s; animation-delay: 2s; }
    .snowflake:nth-child(4) { left: 40%; animation-duration: 9s; animation-delay: 0.5s; }
    .snowflake:nth-child(5) { left: 50%; animation-duration: 11s; animation-delay: 1.5s; }
    .snowflake:nth-child(6) { left: 60%; animation-duration: 10s; animation-delay: 0s; }
    .snowflake:nth-child(7) { left: 70%; animation-duration: 13s; animation-delay: 2.5s; }
    .snowflake:nth-child(8) { left: 80%; animation-duration: 9s; animation-delay: 1s; }
    .snowflake:nth-child(9) { left: 90%; animation-duration: 11s; animation-delay: 0.5s; }
    .snowflake:nth-child(10) { left: 15%; animation-duration: 10s; animation-delay: 3s; }

    h1 {
      text-align: center;
      color: #ffffff;
      margin-bottom: 10px;
      font-size: 2rem;
      text-shadow: 2px 2px 8px rgba(255, 111, 0, 0.8),
                   0 0 20px rgba(255, 215, 0, 0.6);
      position: relative;
      z-index: 10;
    }

    .subtitle {
      text-align: center;
      color: #ffd700;
      font-size: 1.1rem;
      margin-bottom: 20px;
      text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.6);
      position: relative;
      z-index: 10;
    }

    /* =================================
       ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¿ã‚¤ãƒ«
       ================================= */
    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      position: relative;
      z-index: 10;
    }

    .tab-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      background: linear-gradient(135deg, #7b1fa2, #9c27b0);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(156, 39, 176, 0.4);
    }

    .tab-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(156, 39, 176, 0.6);
      background: linear-gradient(135deg, #9c27b0, #ba68c8);
    }

    .tab-btn.active {
      background: linear-gradient(135deg, #ff6f00, #ffa726);
      box-shadow: 0 6px 25px rgba(255, 111, 0, 0.6);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* =================================
       ã‚«ãƒ¼ãƒ‰ãƒ»ã‚³ãƒ³ãƒ†ãƒŠ
       ================================= */
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      position: relative;
      z-index: 10;
    }

    /* =================================
       ãƒ•ã‚©ãƒ¼ãƒ ã‚¹ã‚¿ã‚¤ãƒ«
       ================================= */
    .form-section {
      margin-bottom: 30px;
      padding: 20px;
      background: linear-gradient(135deg, #f3e5f5, #e1bee7);
      border-radius: 15px;
      border-left: 5px solid #7b1fa2;
    }

    .form-section h2 {
      color: #4a148c;
      margin-bottom: 15px;
      font-size: 1.4rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-section h2::before {
      content: 'ğŸ¸';
      font-size: 1.6rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    @media (max-width: 600px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #4a148c;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .required {
      color: #d32f2f;
      font-weight: bold;
      margin-left: 4px;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #ba68c8;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: white;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #7b1fa2;
      box-shadow: 0 0 0 3px rgba(123, 31, 162, 0.1);
    }

    /* =================================
       æ—¥æ™‚é¸æŠï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
       ================================= */
    .slots-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 10px;
    }

    @media (max-width: 600px) {
      .slots-container {
        grid-template-columns: 1fr;
      }
    }

    .slot-checkbox {
      position: relative;
    }

    .slot-checkbox input[type="checkbox"] {
      display: none;
    }

    .slot-label {
      display: block;
      padding: 15px;
      border: 2px solid #ba68c8;
      border-radius: 10px;
      background: white;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      font-weight: 600;
      color: #4a148c;
    }

    .slot-checkbox input[type="checkbox"]:checked + .slot-label {
      background: linear-gradient(135deg, #7b1fa2, #9c27b0);
      color: white;
      border-color: #7b1fa2;
      box-shadow: 0 4px 15px rgba(123, 31, 162, 0.4);
    }

    .slot-checkbox input[type="checkbox"]:disabled + .slot-label {
      background: #e0e0e0;
      color: #9e9e9e;
      border-color: #bdbdbd;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .slot-label:hover:not(.disabled) {
      border-color: #7b1fa2;
      box-shadow: 0 2px 10px rgba(123, 31, 162, 0.2);
    }

    .slot-status {
      display: block;
      font-size: 0.85rem;
      margin-top: 5px;
      font-weight: normal;
    }

    /* =================================
       ãƒœã‚¿ãƒ³
       ================================= */
    .submit-btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #ff6f00, #ffa726);
      color: white;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 6px 20px rgba(255, 111, 0, 0.4);
      margin-top: 20px;
    }

    .submit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(255, 111, 0, 0.6);
    }

    .submit-btn:disabled {
      background: #9e9e9e;
      cursor: not-allowed;
      transform: none;
    }

    /* =================================
       ç™»éŒ²çŠ¶æ³è¡¨ç¤º
       ================================= */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, #7b1fa2, #9c27b0);
      color: white;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 4px 15px rgba(123, 31, 162, 0.3);
    }

    .stat-card h3 {
      font-size: 0.9rem;
      margin-bottom: 10px;
      opacity: 0.9;
    }

    .stat-card .number {
      font-size: 2rem;
      font-weight: bold;
    }

    .slots-status {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    @media (max-width: 600px) {
      .slots-status {
        grid-template-columns: 1fr;
      }
    }

    .slot-status-card {
      background: white;
      padding: 15px;
      border-radius: 10px;
      border-left: 4px solid #7b1fa2;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .slot-status-card h4 {
      color: #4a148c;
      margin-bottom: 8px;
      font-size: 1rem;
    }

    .slot-status-card .capacity {
      font-size: 1.3rem;
      font-weight: bold;
      color: #7b1fa2;
    }

    .slot-status-card.full {
      border-left-color: #d32f2f;
    }

    .slot-status-card.full .capacity {
      color: #d32f2f;
    }

    /* =================================
       ç®¡ç†è€…ç”»é¢
       ================================= */
    .admin-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .admin-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .admin-btn.refresh {
      background: linear-gradient(135deg, #00897b, #26a69a);
      color: white;
    }

    .admin-btn.delete {
      background: linear-gradient(135deg, #d32f2f, #f44336);
      color: white;
    }

    .admin-btn.restore {
      background: linear-gradient(135deg, #1976d2, #2196f3);
      color: white;
    }

    .admin-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    thead {
      background: linear-gradient(135deg, #7b1fa2, #9c27b0);
      color: white;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e0e0e0;
    }

    th {
      font-weight: 600;
      font-size: 0.9rem;
    }

    tbody tr:hover {
      background: #f3e5f5;
    }

    .deleted-row {
      background: #ffebee !important;
      opacity: 0.7;
    }

    /* =================================
       æˆåŠŸç”»é¢
       ================================= */
    .success-container {
      text-align: center;
      padding: 40px 20px;
    }

    .success-icon {
      font-size: 5rem;
      margin-bottom: 20px;
      animation: bounce 1s ease;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .success-title {
      font-size: 2rem;
      color: #4a148c;
      margin-bottom: 15px;
      font-weight: bold;
    }

    .success-message {
      font-size: 1.1rem;
      color: #666;
      margin-bottom: 30px;
      line-height: 1.8;
    }

    .info-box {
      background: linear-gradient(135deg, #fff3e0, #ffe0b2);
      padding: 25px;
      border-radius: 15px;
      margin: 30px 0;
      border-left: 5px solid #ff6f00;
      text-align: left;
    }

    .info-box h3 {
      color: #e65100;
      margin-bottom: 15px;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .info-box h3::before {
      content: 'ğŸ’°';
      font-size: 1.5rem;
    }

    .info-box p {
      margin: 10px 0;
      color: #5d4037;
      line-height: 1.8;
    }

    .info-box strong {
      color: #bf360c;
    }

    .warning-box {
      background: linear-gradient(135deg, #ffebee, #ffcdd2);
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border-left: 5px solid #d32f2f;
      text-align: left;
    }

    .warning-box h3 {
      color: #c62828;
      margin-bottom: 12px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .warning-box h3::before {
      content: 'âš ï¸';
      font-size: 1.4rem;
    }

    .warning-box ul {
      margin-left: 20px;
      color: #b71c1c;
    }

    .warning-box li {
      margin: 8px 0;
      line-height: 1.6;
    }

    .venue-box {
      background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
      padding: 20px;
      border-radius: 12px;
      margin: 20px 0;
      border-left: 5px solid #388e3c;
      text-align: left;
    }

    .venue-box h3 {
      color: #1b5e20;
      margin-bottom: 12px;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .venue-box h3::before {
      content: 'ğŸ“';
      font-size: 1.4rem;
    }

    .venue-box p {
      margin: 8px 0;
      color: #2e7d32;
      line-height: 1.8;
    }

    /* =================================
       ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
       ================================= */
    .loading {
      display: none;
      text-align: center;
      padding: 20px;
      color: #7b1fa2;
      font-weight: bold;
      font-size: 1.1rem;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 4px solid #f3e5f5;
      border-top: 4px solid #7b1fa2;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* =================================
       ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
       ================================= */
    .error-message {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      border-left: 4px solid #d32f2f;
      display: none;
    }

    .error-message.active {
      display: block;
    }

    /* =================================
       ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–èª¿æ•´
       ================================= */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.5rem;
      }

      .subtitle {
        font-size: 0.95rem;
      }

      .container {
        padding: 20px;
      }

      .form-section {
        padding: 15px;
      }

      table {
        font-size: 0.85rem;
      }

      th, td {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <!-- é›ªã®çµæ™¶ -->
  <div class="snowflake">â„</div>
  <div class="snowflake">â…</div>
  <div class="snowflake">â†</div>
  <div class="snowflake">â„</div>
  <div class="snowflake">â…</div>
  <div class="snowflake">â†</div>
  <div class="snowflake">â„</div>
  <div class="snowflake">â…</div>
  <div class="snowflake">â†</div>
  <div class="snowflake">â„</div>

  <h1 id="mainTitle">ğŸ ãªã‚‰ãƒãƒ‰å¹´æœ«å¹´å§‹ãƒãƒ‰ãƒŸãƒ³ãƒˆãƒ³äº¤æµä¼š ğŸ</h1>
  <div class="subtitle">2025å¹´12æœˆ30æ—¥ãƒ»31æ—¥ãƒ»2026å¹´1æœˆ1æ—¥ãƒ»2æ—¥ é–‹å‚¬</div>

  <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ -->
  <div class="tabs">
    <button class="tab-btn active" onclick="switchTab('entry')">ğŸ“ ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ </button>
    <button class="tab-btn" onclick="switchTab('status')">ğŸ“Š ç™»éŒ²çŠ¶æ³</button>
    <button class="tab-btn" onclick="switchTab('admin')">ğŸ” ç®¡ç†è€…ç”»é¢</button>
  </div>

  <!-- ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ  -->
  <div id="entryTab" class="tab-content active">
    <div class="container">
      <form id="entryForm">
        <!-- åŸºæœ¬æƒ…å ± -->
        <div class="form-section">
          <h2>åŸºæœ¬æƒ…å ±</h2>
          
          <div class="form-row">
            <div class="form-group">
              <label>æ°å<span class="required">*</span></label>
              <input type="text" id="name" name="name" required placeholder="ä¾‹: å±±ç”°å¤ªéƒ">
            </div>
            
            <div class="form-group">
              <label>ãƒ•ãƒªã‚¬ãƒŠ<span class="required">*</span></label>
              <input type="text" id="kana" name="kana" required placeholder="ä¾‹: ãƒ¤ãƒãƒ€ã‚¿ãƒ­ã‚¦">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<span class="required">*</span></label>
              <input type="email" id="email" name="email" required placeholder="example@mail.com">
            </div>
            
            <div class="form-group">
              <label>é›»è©±ç•ªå·<span class="required">*</span></label>
              <input type="tel" id="phone" name="phone" required placeholder="090-1234-5678">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>å­¦å¹´ãƒ»å¹´é½¢<span class="required">*</span></label>
              <select id="grade" name="grade" required>
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="å°å­¦1å¹´">å°å­¦1å¹´</option>
                <option value="å°å­¦2å¹´">å°å­¦2å¹´</option>
                <option value="å°å­¦3å¹´">å°å­¦3å¹´</option>
                <option value="å°å­¦4å¹´">å°å­¦4å¹´</option>
                <option value="å°å­¦5å¹´">å°å­¦5å¹´</option>
                <option value="å°å­¦6å¹´">å°å­¦6å¹´</option>
                <option value="ä¸­å­¦1å¹´">ä¸­å­¦1å¹´</option>
                <option value="ä¸­å­¦2å¹´">ä¸­å­¦2å¹´</option>
                <option value="ä¸­å­¦3å¹´">ä¸­å­¦3å¹´</option>
                <option value="é«˜æ ¡1å¹´">é«˜æ ¡1å¹´</option>
                <option value="é«˜æ ¡2å¹´">é«˜æ ¡2å¹´</option>
                <option value="é«˜æ ¡3å¹´">é«˜æ ¡3å¹´</option>
                <option value="å¤§å­¦ç”Ÿ">å¤§å­¦ç”Ÿ</option>
                <option value="ç¤¾ä¼šäºº(20ä»£)">ç¤¾ä¼šäºº(20ä»£)</option>
                <option value="ç¤¾ä¼šäºº(30ä»£)">ç¤¾ä¼šäºº(30ä»£)</option>
                <option value="ç¤¾ä¼šäºº(40ä»£)">ç¤¾ä¼šäºº(40ä»£)</option>
                <option value="ç¤¾ä¼šäºº(50ä»£ä»¥ä¸Š)">ç¤¾ä¼šäºº(50ä»£ä»¥ä¸Š)</option>
              </select>
            </div>

            <div class="form-group">
              <label>æ€§åˆ¥<span class="required">*</span></label>
              <select id="gender" name="gender" required>
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="ç”·æ€§">ç”·æ€§</option>
                <option value="å¥³æ€§">å¥³æ€§</option>
              </select>
            </div>
          </div>
        </div>

        <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ -->
        <div class="form-section">
          <h2>å‚åŠ ã‚«ãƒ†ã‚´ãƒªãƒ¼</h2>
          <div class="form-group">
            <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼<span class="required">*</span></label>
            <select id="category" name="category" required>
              <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
              <option value="ã‚«ãƒ†ã‚´ãƒªãƒ¼A">ã‚«ãƒ†ã‚´ãƒªãƒ¼A (å°å­¦ç”Ÿã€œä¸­å­¦å…¨å¸‚ãƒ¬ãƒ™ãƒ«)</option>
              <option value="ã‚«ãƒ†ã‚´ãƒªãƒ¼B">ã‚«ãƒ†ã‚´ãƒªãƒ¼B (ä¸­å­¦å…¨å¸‚16ä»¥ä¸Šã€œç¤¾ä¼šäºº)</option>
            </select>
          </div>
        </div>

        <!-- å‚åŠ å¸Œæœ›æ—¥æ™‚ -->
        <div class="form-section">
          <h2>å‚åŠ å¸Œæœ›æ—¥æ™‚ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</h2>
          <p style="color: #666; margin-bottom: 15px; font-size: 0.95rem;">
            â€» å‚åŠ ã—ãŸã„æ—¥æ™‚ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆè¤‡æ•°é¸æŠå¯èƒ½ï¼‰
          </p>
          
          <div class="slots-container" id="slotsContainer">
            <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
          </div>
        </div>

        <div class="error-message" id="errorMessage"></div>
        <div class="loading" id="loading">
          <div class="spinner"></div>
          ç™»éŒ²å‡¦ç†ä¸­...
        </div>

        <button type="submit" class="submit-btn">ğŸ¸ å‚åŠ ç”³è¾¼ã‚’é€ä¿¡</button>
      </form>
    </div>
  </div>

  <!-- ç™»éŒ²çŠ¶æ³ -->
  <div id="statusTab" class="tab-content">
    <div class="container">
      <h2 style="color: #4a148c; margin-bottom: 20px;">ğŸ“Š ç¾åœ¨ã®ç™»éŒ²çŠ¶æ³</h2>
      
      <div class="stats-container">
        <div class="stat-card">
          <h3>ç·å‚åŠ è€…æ•°</h3>
          <div class="number" id="totalParticipants">-</div>
        </div>
      </div>

      <h3 style="color: #4a148c; margin: 30px 0 15px 0;">å„éƒ¨ã®å®šå“¡çŠ¶æ³</h3>
      <div class="slots-status" id="slotsStatus">
        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
      </div>

      <div class="loading" id="statusLoading">
        <div class="spinner"></div>
        èª­è¾¼ä¸­...
      </div>
    </div>
  </div>

  <!-- ç®¡ç†è€…ç”»é¢ -->
  <div id="adminTab" class="tab-content">
    <div class="container">
      <h2 style="color: #4a148c; margin-bottom: 20px;">ğŸ” ç®¡ç†è€…ç”»é¢</h2>

      <div id="adminLogin">
        <div class="form-group">
          <label>ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
          <input type="password" id="adminPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›">
        </div>
        <button class="submit-btn" onclick="adminLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
      </div>

      <div id="adminPanel" style="display: none;">
        <div class="admin-controls">
          <button class="admin-btn refresh" onclick="loadAdminData()">ğŸ”„ æ›´æ–°</button>
          <button class="admin-btn delete" onclick="deleteSelected()">ğŸ—‘ï¸ é¸æŠã‚’å‰Šé™¤</button>
          <button class="admin-btn restore" onclick="restoreSelected()">â†©ï¸ é¸æŠã‚’å¾©å…ƒ</button>
          <button class="admin-btn delete" onclick="permanentDeleteSelected()">âŒ å®Œå…¨å‰Šé™¤</button>
        </div>

        <div style="overflow-x: auto;">
          <table id="adminTable">
            <thead>
              <tr>
                <th><input type="checkbox" onclick="toggleAllCheckboxes(this)"></th>
                <th>ID</th>
                <th>æ°å</th>
                <th>ãƒ•ãƒªã‚¬ãƒŠ</th>
                <th>ãƒ¡ãƒ¼ãƒ«</th>
                <th>é›»è©±</th>
                <th>å­¦å¹´</th>
                <th>æ€§åˆ¥</th>
                <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
                <th>å‚åŠ æ—¥æ™‚</th>
                <th>çŠ¶æ…‹</th>
              </tr>
            </thead>
            <tbody id="adminTableBody">
              <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
            </tbody>
          </table>
        </div>

        <div class="loading" id="adminLoading">
          <div class="spinner"></div>
          èª­è¾¼ä¸­...
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== è¨­å®š =====
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbz2RrUtVjwAL0TIqcLeOK5MxEhVALPuiR1nbqWwuoky3XGqoJwPFxIBGYXIoZH08RjLpA/exec';
    const ADMIN_PASSWORD = 'newyear2026';
    const AUTO_REFRESH_INTERVAL = 30000; // 30ç§’

    // æ—¥æ™‚ã‚¹ãƒ­ãƒƒãƒˆå®šç¾©
    const SLOTS = [
      { id: '12/30â‘ ', label: '12/30(æœˆ) â‘ ', time: '12:30ã€œ14:30' },
      { id: '12/30â‘¡', label: '12/30(æœˆ) â‘¡', time: '15:00ã€œ17:00' },
      { id: '12/31â‘ ', label: '12/31(ç«) â‘ ', time: '8:00ã€œ10:00' },
      { id: '12/31â‘¡', label: '12/31(ç«) â‘¡', time: '10:30ã€œ12:30' },
      { id: '1/1â‘ ', label: '1/1(æ°´) â‘ ', time: '11:00ã€œ13:00' },
      { id: '1/1â‘¡', label: '1/1(æ°´) â‘¡', time: '13:30ã€œ15:30' },
      { id: '1/2â‘ ', label: '1/2(æœ¨) â‘ ', time: '9:00ã€œ11:00' },
      { id: '1/2â‘¡', label: '1/2(æœ¨) â‘¡', time: '11:30ã€œ13:30' }
    ];

    let capacityStatus = {};
    let autoRefreshTimer = null;

    // ===== åˆæœŸåŒ– =====
    document.addEventListener('DOMContentLoaded', function() {
      initSlotsCheckboxes();
      loadCapacityStatus();
      startAutoRefresh();
    });

    // ===== ã‚¹ãƒ­ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹åˆæœŸåŒ– =====
    function initSlotsCheckboxes() {
      const container = document.getElementById('slotsContainer');
      container.innerHTML = '';

      SLOTS.forEach(slot => {
        const div = document.createElement('div');
        div.className = 'slot-checkbox';
        div.innerHTML = `
          <input type="checkbox" id="slot_${slot.id}" name="slots" value="${slot.id}">
          <label for="slot_${slot.id}" class="slot-label" id="label_${slot.id}">
            <strong>${slot.label}</strong><br>
            ${slot.time}<br>
            <span class="slot-status" id="status_${slot.id}">èª­è¾¼ä¸­...</span>
          </label>
        `;
        container.appendChild(div);
      });
    }

    // ===== å®šå“¡çŠ¶æ³å–å¾— =====
    async function loadCapacityStatus() {
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'getCapacity' })
        });

        const result = await response.json();
        
        if (result.success) {
          capacityStatus = result.status;
          updateSlotsDisplay();
          updateStatusDisplay();
        }
      } catch (error) {
        console.error('å®šå“¡çŠ¶æ³ã®å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
      }
    }

    // ===== ã‚¹ãƒ­ãƒƒãƒˆè¡¨ç¤ºæ›´æ–° =====
    function updateSlotsDisplay() {
      SLOTS.forEach(slot => {
        const checkbox = document.getElementById(`slot_${slot.id}`);
        const label = document.getElementById(`label_${slot.id}`);
        const status = document.getElementById(`status_${slot.id}`);
        
        if (capacityStatus[slot.id]) {
          const data = capacityStatus[slot.id];
          const remaining = data.remaining;
          const isFull = data.isFull;

          if (isFull) {
            checkbox.disabled = true;
            checkbox.checked = false;
            label.classList.add('disabled');
            status.textContent = 'å—ä»˜çµ‚äº†';
            status.style.color = '#d32f2f';
          } else {
            checkbox.disabled = false;
            label.classList.remove('disabled');
            status.textContent = `æ®‹ã‚Š${remaining}å`;
            status.style.color = remaining <= 5 ? '#ff6f00' : '#388e3c';
          }
        }
      });
    }

    // ===== ç™»éŒ²çŠ¶æ³è¡¨ç¤ºæ›´æ–° =====
    function updateStatusDisplay() {
      const statusContainer = document.getElementById('slotsStatus');
      statusContainer.innerHTML = '';

      // ç·å‚åŠ è€…æ•°
      let totalCount = 0;
      SLOTS.forEach(slot => {
        if (capacityStatus[slot.id]) {
          totalCount += capacityStatus[slot.id].current;
        }
      });
      
      // é‡è¤‡ã‚’è€ƒæ…®ã—ã¦å®Ÿéš›ã®å‚åŠ è€…æ•°ã‚’å–å¾—
      fetch(GAS_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action: 'get', limit: 1000 })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById('totalParticipants').textContent = data.total || 0;
      });

      SLOTS.forEach(slot => {
        if (capacityStatus[slot.id]) {
          const data = capacityStatus[slot.id];
          const card = document.createElement('div');
          card.className = 'slot-status-card' + (data.isFull ? ' full' : '');
          
          card.innerHTML = `
            <h4>${slot.label} ${slot.time}</h4>
            <div class="capacity">
              ${data.current} / ${data.capacity} å
              ${data.isFull ? 'ï¼ˆå—ä»˜çµ‚äº†ï¼‰' : ''}
            </div>
          `;
          statusContainer.appendChild(card);
        }
      });
    }

    // ===== è‡ªå‹•æ›´æ–° =====
    function startAutoRefresh() {
      autoRefreshTimer = setInterval(() => {
        const activeTab = document.querySelector('.tab-content.active');
        if (activeTab.id === 'statusTab' || activeTab.id === 'entryTab') {
          loadCapacityStatus();
        }
      }, AUTO_REFRESH_INTERVAL);
    }

    // ===== ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ =====
    function switchTab(tabName) {
      // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã®åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });

      const tabMap = {
        'entry': 'entryTab',
        'status': 'statusTab',
        'admin': 'adminTab'
      };

      document.getElementById(tabMap[tabName]).classList.add('active');

      // ã‚¿ãƒ–ã«å¿œã˜ã¦ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
      if (tabName === 'status') {
        loadCapacityStatus();
      }
    }

    // ===== ç”³è¾¼ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ =====
    document.getElementById('entryForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const errorMsg = document.getElementById('errorMessage');
      errorMsg.classList.remove('active');

      // é¸æŠã•ã‚ŒãŸã‚¹ãƒ­ãƒƒãƒˆã‚’å–å¾—
      const selectedSlots = [];
      document.querySelectorAll('input[name="slots"]:checked').forEach(cb => {
        selectedSlots.push(cb.value);
      });

      if (selectedSlots.length === 0) {
        errorMsg.textContent = 'å‚åŠ å¸Œæœ›æ—¥æ™‚ã‚’æœ€ä½1ã¤é¸æŠã—ã¦ãã ã•ã„ã€‚';
        errorMsg.classList.add('active');
        return;
      }

      const formData = {
        action: 'add',
        name: document.getElementById('name').value,
        kana: document.getElementById('kana').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        grade: document.getElementById('grade').value,
        gender: document.getElementById('gender').value,
        category: document.getElementById('category').value,
        slots: selectedSlots.join(', ')
      };

      const loading = document.getElementById('loading');
      loading.classList.add('active');

      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (result.success) {
          showSuccessScreen(formData);
        } else if (result.error === 'CAPACITY_FULL') {
          errorMsg.textContent = result.message;
          errorMsg.classList.add('active');
          await loadCapacityStatus(); // å®šå“¡çŠ¶æ³ã‚’æ›´æ–°
        } else {
          errorMsg.textContent = 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼');
          errorMsg.classList.add('active');
        }
      } catch (error) {
        errorMsg.textContent = 'é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚';
        errorMsg.classList.add('active');
      } finally {
        loading.classList.remove('active');
      }
    });

    // ===== æˆåŠŸç”»é¢è¡¨ç¤º =====
    function showSuccessScreen(data) {
      const container = document.querySelector('#entryTab .container');
      container.innerHTML = `
        <div class="success-container">
          <div class="success-icon">ğŸ‰</div>
          <h2 class="success-title">å‚åŠ ç”³è¾¼ãŒå®Œäº†ã—ã¾ã—ãŸï¼</h2>
          <p class="success-message">
            ã”ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>
            ${data.name} æ§˜ã®å‚åŠ ç”³è¾¼ã‚’å—ã‘ä»˜ã‘ã¾ã—ãŸã€‚
          </p>

          <div class="info-box">
            <h3>æŒ¯è¾¼å…ˆæƒ…å ±</h3>
            <p><strong>éŠ€è¡Œå:</strong> GMOã‚ãŠãã‚‰ãƒãƒƒãƒˆéŠ€è¡Œ</p>
            <p><strong>æ”¯åº—å:</strong> æ³•äººå–¶æ¥­éƒ¨ï¼ˆ101ï¼‰</p>
            <p><strong>å£åº§ç¨®åˆ¥:</strong> æ™®é€š</p>
            <p><strong>å£åº§ç•ªå·:</strong> 2291137</p>
            <p><strong>å£åº§åç¾©:</strong> ä¸€èˆ¬ç¤¾å›£æ³•äººPlusMind</p>
            <p style="margin-top: 15px; font-size: 1.1rem;">
              <strong style="color: #bf360c;">æŒ¯è¾¼æœŸæ—¥: 2025å¹´12æœˆ20æ—¥(åœŸ)ã¾ã§</strong>
            </p>
            <p><strong style="color: #bf360c;">å‚åŠ è²»: 2,000å††</strong></p>
          </div>

          <div class="warning-box">
            <h3>é‡è¦ãªæ³¨æ„äº‹é …</h3>
            <ul>
              <li>æŒ¯è¾¼æœŸæ—¥ã¾ã§ã«å…¥é‡‘ãŒãªã„å ´åˆã¯<strong>è‡ªå‹•ã‚­ãƒ£ãƒ³ã‚»ãƒ«</strong>ã¨ãªã‚Šã¾ã™</li>
              <li>ãŠç”³è¾¼å¾Œã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã«ã‚ˆã‚‹<strong>è¿”é‡‘ã¯è‡´ã—ã‹ã­ã¾ã™</strong></li>
              <li><strong>ã‚·ãƒ£ãƒˆãƒ«2å€‹</strong>ã‚’å¿…ãšã”æŒå‚ãã ã•ã„</li>
              <li>ä¿é™ºåŠ å…¥ã¯å„è‡ªã§ã”ç¢ºèªãã ã•ã„</li>
              <li>æ€ªæˆ‘ãƒ»äº‹æ•…ã«ã¤ã„ã¦ã¯<strong>è‡ªå·±è²¬ä»»</strong>ã¨ãªã‚Šã¾ã™</li>
            </ul>
          </div>

          <div class="info-box" style="background: linear-gradient(135deg, #e3f2fd, #bbdefb); border-left-color: #1976d2;">
            <h3 style="color: #0d47a1;">ğŸ“¦ å½“æ—¥ã®æŒã¡ç‰©</h3>
            <ul style="color: #1565c0; margin-left: 20px;">
              <li>ãƒ©ã‚±ãƒƒãƒˆ</li>
              <li>å®¤å†…ã‚·ãƒ¥ãƒ¼ã‚º</li>
              <li>ã‚·ãƒ£ãƒˆãƒ«2å€‹</li>
            </ul>
          </div>

          <div class="venue-box">
            <h3>ä¼šå ´æƒ…å ±</h3>
            <p><strong>ä¼šå ´:</strong> æœ­å¹Œé¾è°·é«˜æ ¡ä½“è‚²é¤¨</p>
            <p><strong>ä½æ‰€:</strong> æœ­å¹Œå¸‚ä¸­å¤®åŒºåŒ—4æ¡è¥¿19ä¸ç›®1-2</p>
            <p style="margin-top: 10px; color: #c62828;">
              <strong>é§è»Šå ´ã«ã¤ã„ã¦:</strong><br>
              é§è»Šå ´ã¯åˆ©ç”¨ã§ãã¾ã™ãŒã€å¤§é›ªã®å ´åˆé™¤é›ªãŒå…¥ã‚‰ãªã„ã®ã§ä½¿ç”¨ã§ããªã„å ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>
              ãã®éš›ã¯è¿‘ãã®æœ‰æ–™é§è»Šå ´ã‚’ã”ä½¿ç”¨ãã ã•ã„ã€‚<br>
              <strong style="font-size: 1.1rem;">â€» æ±ºã—ã¦éš£ã®ãŠå¯ºã®é§è»Šå ´ã«ã¯æ­¢ã‚ãªã„ã§ãã ã•ã„</strong>
            </p>
          </div>

          <p style="color: #666; margin-top: 30px; line-height: 1.8;">
            å½“æ—¥ã¯æ™¯å“ã‚‚ã”ç”¨æ„ã—ã¦ãŠã‚Šã¾ã™ï¼<br>
            ã¾ãŸã€å†™çœŸæ’®å½±ã‚’è¡Œã„ã€SNSç­‰ã«æ²è¼‰ã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚<br>
            çš†æ§˜ã®ã”å‚åŠ ã‚’å¿ƒã‚ˆã‚ŠãŠå¾…ã¡ã—ã¦ãŠã‚Šã¾ã™ï¼
          </p>

          <button class="submit-btn" onclick="location.reload()">
            ğŸ  ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹
          </button>
        </div>
      `;
    }

    // ===== ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ =====
    function adminLogin() {
      const password = document.getElementById('adminPassword').value;
      
      if (password === ADMIN_PASSWORD) {
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadAdminData();
      } else {
        alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™');
      }
    }

    // ===== ç®¡ç†è€…ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ =====
    async function loadAdminData() {
      const loading = document.getElementById('adminLoading');
      loading.classList.add('active');

      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'getAll' })
        });

        const result = await response.json();
        
        if (result.items) {
          displayAdminTable(result.items);
        }
      } catch (error) {
        alert('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
      } finally {
        loading.classList.remove('active');
      }
    }

    // ===== ç®¡ç†è€…ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤º =====
    function displayAdminTable(items) {
      const tbody = document.getElementById('adminTableBody');
      tbody.innerHTML = '';

      items.forEach(item => {
        const isDeleted = item.delete_flag == 1;
        const row = document.createElement('tr');
        if (isDeleted) row.className = 'deleted-row';

        row.innerHTML = `
          <td><input type="checkbox" value="${item.id}"></td>
          <td>${item.id}</td>
          <td>${item.name || ''}</td>
          <td>${item.kana || ''}</td>
          <td>${item.email || ''}</td>
          <td>${item.phone || ''}</td>
          <td>${item.grade || ''}</td>
          <td>${item.gender || ''}</td>
          <td>${item.category || ''}</td>
          <td>${item.slots || ''}</td>
          <td>${isDeleted ? 'å‰Šé™¤æ¸ˆã¿' : 'æœ‰åŠ¹'}</td>
        `;
        tbody.appendChild(row);
      });
    }

    // ===== å…¨é¸æŠåˆ‡ã‚Šæ›¿ãˆ =====
    function toggleAllCheckboxes(source) {
      const checkboxes = document.querySelectorAll('#adminTableBody input[type="checkbox"]');
      checkboxes.forEach(cb => cb.checked = source.checked);
    }

    // ===== é¸æŠè¡Œå–å¾— =====
    function getSelectedIds() {
      const ids = [];
      document.querySelectorAll('#adminTableBody input[type="checkbox"]:checked').forEach(cb => {
        ids.push(cb.value);
      });
      return ids;
    }

    // ===== å‰Šé™¤ =====
    async function deleteSelected() {
      const ids = getSelectedIds();
      if (ids.length === 0) {
        alert('å‰Šé™¤ã™ã‚‹è¡Œã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      if (!confirm(`${ids.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆå¾©å…ƒå¯èƒ½ãªè«–ç†å‰Šé™¤ã§ã™ï¼‰`)) {
        return;
      }

      for (const id of ids) {
        await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'delete', id: id })
        });
      }

      alert('å‰Šé™¤ã—ã¾ã—ãŸ');
      loadAdminData();
      loadCapacityStatus();
    }

    // ===== å¾©å…ƒ =====
    async function restoreSelected() {
      const ids = getSelectedIds();
      if (ids.length === 0) {
        alert('å¾©å…ƒã™ã‚‹è¡Œã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      if (!confirm(`${ids.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ`)) {
        return;
      }

      for (const id of ids) {
        await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'restore', id: id })
        });
      }

      alert('å¾©å…ƒã—ã¾ã—ãŸ');
      loadAdminData();
      loadCapacityStatus();
    }

    // ===== å®Œå…¨å‰Šé™¤ =====
    async function permanentDeleteSelected() {
      const ids = getSelectedIds();
      if (ids.length === 0) {
        alert('å®Œå…¨å‰Šé™¤ã™ã‚‹è¡Œã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }

      if (!confirm(`${ids.length}ä»¶ã®ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nâš ï¸ ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ï¼`)) {
        return;
      }

      if (!confirm('æœ¬å½“ã«å®Œå…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆæœ€çµ‚ç¢ºèªï¼‰')) {
        return;
      }

      for (const id of ids) {
        await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: 'permanentDelete', id: id })
        });
      }

      alert('å®Œå…¨å‰Šé™¤ã—ã¾ã—ãŸ');
      loadAdminData();
      loadCapacityStatus();
    }
  </script>
</body>
</html>
